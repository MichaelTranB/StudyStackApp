"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7082],{7082:(y,f,c)=>{c.r(f),c.d(f,{NewOfferPageModule:()=>j});var p=c(177),r=c(4341),u=c(5171),i=c(4742),e=c(3953),g=c(8591),k=c(5558),h=c(6354),v=c(7673),P=c(2276),d=c(5312),b=c(1626);function w(o,s){1&o&&e.nrm(0,"ion-spinner",4)}function C(o,s){if(1&o){const l=e.RV6();e.j41(0,"ion-img",5),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.onPickLocation())}),e.k0s()}if(2&o){const l=e.XpG();e.Y8G("src",l.selectedLocationImage)}}function L(o,s){if(1&o){const l=e.RV6();e.j41(0,"ion-button",6),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.onPickLocation())}),e.nrm(1,"ion-icon",7),e.j41(2,"ion-label"),e.EFF(3,"Select Location"),e.k0s()()}}let I=(()=>{var o;class s{constructor(t,n){this.modalCtrl=t,this.http=n,this.locationPick=new e.bkB,this.isLoading=!1}ngOnInit(){}onPickLocation(){this.modalCtrl.create({component:P.z}).then(t=>{t.onDidDismiss().then(n=>{if(!n.data)return;const a={lat:n.data.lat,lng:n.data.lng,address:null,staticMapImageUrl:null};this.isLoading=!0,this.getAddress(n.data.lat,n.data.lng).pipe((0,k.n)(m=>(a.address=m,(0,v.of)(this.getMapImage(a.lat,a.lng,14))))).subscribe(m=>{a.staticMapImageUrl=m,this.selectedLocationImage=m,this.isLoading=!1,this.locationPick.emit(a)})}),t.present()})}getAddress(t,n){return this.http.get(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${n}&key=${d.c.googleMapsAPIKey}`).pipe((0,h.T)(a=>a&&a.results&&0!==a.results.length?a.results[0].formatted_address:null))}getMapImage(t,n,a){return`https://maps.googleapis.com/maps/api/staticmap?center=${t},${n}&zoom=${a}&size=500x300&maptype=roadmap\n    &markers=color:red%7Clabel:Place%7C${t},${n}\n    &key=${d.c.googleMapsAPIKey}`}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(i.W3),e.rXU(b.Qq))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-location-picker"]],outputs:{locationPick:"locationPick"},decls:4,vars:3,consts:[[1,"picker"],["color","primary",4,"ngIf"],["role","button","class","location-image",3,"src","click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","primary"],["role","button",1,"location-image",3,"click","src"],["color","primary",3,"click"],["name","map","slot","start"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,w,1,0,"ion-spinner",1)(2,C,1,1,"ion-img",2)(3,L,4,0,"ion-button",3),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",n.selectedLocationImage&&!n.isLoading),e.R7$(),e.Y8G("ngIf",!n.selectedLocationImage&&!n.isLoading))},dependencies:[p.bT,i.Jm,i.iq,i.KW,i.he,i.w2]}),s})();function O(o,s){1&o&&(e.j41(0,"ion-row")(1,"ion-col",6)(2,"p"),e.EFF(3,"Description must be between 1 and 180 characters."),e.k0s()()())}let F=(()=>{var o;class s{constructor(t,n,a){this.placesService=t,this.router=n,this.loadingCtrl=a}ngOnInit(){this.form=new r.gE({title:new r.MJ(null,{updateOn:"blur",validators:[r.k0.required]}),description:new r.MJ(null,{updateOn:"blur",validators:[r.k0.required,r.k0.maxLength(180)]}),price:new r.MJ(null,{updateOn:"blur",validators:[r.k0.required,r.k0.min(1)]}),dateFrom:new r.MJ(null,{updateOn:"blur",validators:[r.k0.required]}),dateTo:new r.MJ(null,{updateOn:"blur",validators:[r.k0.required]}),location:new r.MJ(null,{validators:[r.k0.required]})})}onLocationPicked(t){this.form.patchValue({location:t})}onCreateOffer(){this.form.valid&&this.loadingCtrl.create({message:"Creating place..."}).then(t=>{t.present(),this.placesService.addPlace(this.form.value.title,this.form.value.description,+this.form.value.price,new Date(this.form.value.dateFrom),new Date(this.form.value.dateTo),this.form.value.location).subscribe(()=>{t.dismiss(),this.form.reset(),this.router.navigate(["/places/tabs/offers"])})})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(g._),e.rXU(u.Ix),e.rXU(i.Xi))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-new-offer"]],decls:45,vars:3,consts:[["slot","start"],["defaultHref","/places/tabs/offers"],["slot","primary"],[3,"click","disabled"],["name","checkmark","slot","icon-only"],[3,"formGroup"],["size-sm","6","offset-sm","3"],["position","floating"],["type","text","autocomplete","","autocorrect","","formControlName","title"],["rows","3","formControlName","description"],[4,"ngIf"],["type","number","formControlName","price"],["size-sm","3","offset-sm","3"],["min","2019-01-01","max","2025-12-31","formControlName","dateFrom"],["size-sm","3"],["min","2019-01-02","max","2025-12-31","formControlName","dateTo"],[3,"locationPick"]],template:function(t,n){if(1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"New Offer"),e.k0s(),e.j41(6,"ion-buttons",2)(7,"ion-button",3),e.bIt("click",function(){return n.onCreateOffer()}),e.nrm(8,"ion-icon",4),e.k0s()()()(),e.j41(9,"ion-content")(10,"form",5)(11,"ion-grid")(12,"ion-row")(13,"ion-col",6)(14,"ion-item")(15,"ion-label",7),e.EFF(16,"Title"),e.k0s(),e.nrm(17,"ion-input",8),e.k0s()()(),e.j41(18,"ion-row")(19,"ion-col",6)(20,"ion-item")(21,"ion-label",7),e.EFF(22,"Short Description"),e.k0s(),e.nrm(23,"ion-textarea",9),e.k0s()()(),e.DNE(24,O,4,0,"ion-row",10),e.j41(25,"ion-row")(26,"ion-col",6)(27,"ion-item")(28,"ion-label",7),e.EFF(29,"Price"),e.k0s(),e.nrm(30,"ion-input",11),e.k0s()()(),e.j41(31,"ion-row")(32,"ion-col",12)(33,"ion-item")(34,"ion-label",7),e.EFF(35,"Available from"),e.k0s(),e.nrm(36,"ion-datetime",13),e.k0s()(),e.j41(37,"ion-col",14)(38,"ion-item")(39,"ion-label",7),e.EFF(40,"Available to"),e.k0s(),e.nrm(41,"ion-datetime",15),e.k0s()()(),e.j41(42,"ion-row")(43,"ion-col",12)(44,"app-location-picker",16),e.bIt("locationPick",function(m){return n.onLocationPicked(m)}),e.k0s()()()()()()),2&t){let a;e.R7$(7),e.Y8G("disabled",!n.form.valid),e.R7$(3),e.Y8G("formGroup",n.form),e.R7$(14),e.Y8G("ngIf",!(null!=(a=n.form.get("description"))&&a.valid)&&(null==(a=n.form.get("description"))?null:a.touched))}},dependencies:[p.bT,i.Jm,i.QW,i.hU,i.W9,i.A9,i.lO,i.eU,i.iq,i.$w,i.uz,i.he,i.ln,i.nc,i.BC,i.ai,i.su,i.Je,i.Gw,i.el,r.qT,r.BC,r.cb,r.j4,r.JD,I]}),s})(),M=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.MD,i.bv]}),s})();const N=[{path:"",component:F}];let j=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.MD,i.bv,r.X1,u.iI.forChild(N),M]}),s})()}}]);