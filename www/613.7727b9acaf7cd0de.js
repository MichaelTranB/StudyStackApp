"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[613],{613:(w,v,c)=>{c.r(v),c.d(v,{BookingsPageModule:()=>U});var h=c(177),P=c(4341),F=c(9384),s=c(4742),o=c(3953),T=c(4412),l=c(6697),d=c(5558),u=c(8141),C=c(6354);class S{constructor(g,r,e,i,a,t,k,m,f,p){this.id=g,this.placeId=r,this.userId=e,this.placeTitle=i,this.placeImage=a,this.firstName=t,this.lastName=k,this.guestNumber=m,this.bookedFrom=f,this.bookedTo=p}}var y=c(5709),M=c(1626);let N=(()=>{var n;class g{get bookings(){return this._bookings.asObservable()}constructor(e,i){this.authService=e,this.http=i,this._bookings=new T.t([])}addBooking(e,i,a,t,k,m,f,p){let j;return this.authService.userId.pipe((0,l.s)(1),(0,d.n)(I=>{if(!I)throw new Error("User not found!");const B=new S(Math.random().toString(),e,I,i,a,t,k,m,f,p);return this.http.post("https://bookings-abeec-default-rtdb.firebaseio.com/bookings.json",{...B,id:null}).pipe((0,d.n)(b=>(j=b.name,this.bookings)),(0,l.s)(1),(0,u.M)(b=>{B.id=j,this._bookings.next(b.concat(B))}))}))}cancelBooking(e){return this.http.delete(`https://bookings-abeec-default-rtdb.firebaseio.com/bookings/${e}.json`).pipe((0,d.n)(()=>this.bookings),(0,l.s)(1),(0,u.M)(i=>{this._bookings.next(i.filter(a=>a.id!==e))}))}fetchBookings(){return this.authService.userId.pipe((0,l.s)(1),(0,d.n)(e=>{if(!e)throw new Error("User not found!");return this.http.get(`https://bookings-abeec-default-rtdb.firebaseio.com/bookings.json?orderBy="userId"&equalTo="${e}"`).pipe((0,C.T)(i=>{const a=[];for(const t in i)i.hasOwnProperty(t)&&a.push(new S(t,i[t].placeId,i[t].userId,i[t].placeTitle,i[t].placeImage,i[t].firstName,i[t].lastName,i[t].guestNumber,new Date(i[t].bookedFrom),new Date(i[t].bookedTo)));return a}),(0,u.M)(i=>{this._bookings.next(i)}))}))}}return(n=g).\u0275fac=function(e){return new(e||n)(o.KVO(y.u),o.KVO(M.Qq))},n.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),g})();function $(n,g){1&n&&(o.j41(0,"ion-col",4),o.nrm(1,"ion-spinner",5),o.k0s())}function E(n,g){1&n&&(o.j41(0,"ion-col",4)(1,"p"),o.EFF(2,"No bookings found!"),o.k0s()())}function G(n,g){if(1&n){const r=o.RV6();o.j41(0,"ion-item-sliding",null,0)(2,"ion-item")(3,"ion-avatar",1),o.nrm(4,"ion-img",8),o.k0s(),o.j41(5,"ion-label")(6,"h5"),o.EFF(7),o.k0s(),o.j41(8,"p"),o.EFF(9),o.k0s()()(),o.j41(10,"ion-item-options")(11,"ion-item-option",9),o.bIt("click",function(){const i=o.eBV(r).$implicit,a=o.sdS(1),t=o.XpG(2);return o.Njj(t.onCancelBooking(i.id,a))}),o.nrm(12,"ion-icon",10),o.k0s()()()}if(2&n){const r=g.$implicit;o.R7$(4),o.Y8G("src",r.placeImage),o.R7$(3),o.JRh(r.placeTitle),o.R7$(2),o.SpI("Guests: ",r.guestNumber,"")}}function O(n,g){if(1&n&&(o.j41(0,"ion-col",6)(1,"ion-list"),o.DNE(2,G,13,3,"ion-item-sliding",7),o.k0s()()),2&n){const r=o.XpG();o.R7$(2),o.Y8G("ngForOf",r.loadedBookings)}}const R=[{path:"",component:(()=>{var n;class g{constructor(e,i){this.bookingService=e,this.loadingCtrl=i,this.isLoading=!1}ngOnInit(){this.bookingSub=this.bookingService.bookings.subscribe(e=>{this.loadedBookings=e})}ionViewWillEnter(){this.isLoading=!0,this.bookingService.fetchBookings().subscribe(()=>{this.isLoading=!1})}onCancelBooking(e,i){i.close(),this.loadingCtrl.create({message:"Cancelling..."}).then(a=>{a.present(),this.bookingService.cancelBooking(e).subscribe(()=>{a.dismiss()})})}ngOnDestroy(){this.bookingSub&&this.bookingSub.unsubscribe()}}return(n=g).\u0275fac=function(e){return new(e||n)(o.rXU(N),o.rXU(s.Xi))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-bookings"]],decls:12,vars:3,consts:[["slidingBooking",""],["slot","start"],["size-md","6","offset-md","3","class","ion-text-center",4,"ngIf"],["size-md","6","offset-md","3",4,"ngIf"],["size-md","6","offset-md","3",1,"ion-text-center"],["color","primary"],["size-md","6","offset-md","3"],[4,"ngFor","ngForOf"],[3,"src"],["color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(e,i){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),o.nrm(3,"ion-menu-button"),o.k0s(),o.j41(4,"ion-title"),o.EFF(5,"Your Bookings"),o.k0s()()(),o.j41(6,"ion-content")(7,"ion-grid")(8,"ion-row"),o.DNE(9,$,2,0,"ion-col",2)(10,E,3,0,"ion-col",2)(11,O,3,1,"ion-col",3),o.k0s()()()),2&e&&(o.R7$(9),o.Y8G("ngIf",i.isLoading),o.R7$(),o.Y8G("ngIf",!i.isLoading&&(!i.loadedBookings||i.loadedBookings.length<=0)),o.R7$(),o.Y8G("ngIf",!i.isLoading&&i.loadedBookings&&i.loadedBookings.length>0))},dependencies:[h.Sq,h.bT,s.mC,s.QW,s.hU,s.W9,s.lO,s.eU,s.iq,s.KW,s.uz,s.LU,s.CE,s.A7,s.he,s.nf,s.MC,s.ln,s.w2,s.BC,s.ai]}),g})()}];let U=(()=>{var n;class g{}return(n=g).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[h.MD,P.YN,s.bv,F.iI.forChild(R)]}),g})()}}]);